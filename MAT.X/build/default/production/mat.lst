MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;
                      00002 ; * machine à thé
                      00003 ; * Copyright 2016, Jacques Deschenes
                      00004 ; * 
                      00005 ; * This file is part of machineathe project.
                      00006 ; * 
                      00007 ; * ***  LICENCE ****
                      00008 ; * This program is free software; you can redistribute it and/or modify
                      00009 ; * it under the terms of the GNU General Public License as published by
                      00010 ; * the Free Software Foundation; either version 3 of the License, or
                      00011 ; * (at your option) any later version.
                      00012 ; * 
                      00013 ; * This program is distributed in the hope that it will be useful,
                      00014 ; * but WITHOUT ANY WARRANTY; without even the implied warranty of
                      00015 ; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                      00016 ; * GNU General Public License for more details.
                      00017 ; * 
                      00018 ; * You should have received a copy of the GNU General Public License
                      00019 ; * along with this program; See 'copying.txt' in root directory of source.
                      00020 ; * If not, write to the Free Software Foundation,
                      00021 ; * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
                      00022 ; *  
                      00023 ; * to contact the author:  jd_temp@yahoo.fr
                      00024 ; * 
                      00025  ;
                      00026 ; MAT
                      00027 ; Machine à Thé.
                      00028 ; Description:  Machine avec minuterie pour le trempage d'un sachet de thé.
                      00029 ;   1 bouton pour réglé la durée en multiple de 15 secondes
                      00030 ;   1 bouton pour le démarrage de la séquence
                      00031 ;   1 servo moteur relié à un levier auquel est attaché le sachet. Le sachet est
                      00032 ;   descendu dans la tasse au début de la séquence et remonter à la fin.
                      00033 ;   1 affichage barre de DEL pour indiqué le temps.
                      00034 ;   1 haut-parleur pour l'arlame indiquant la fin de la séquence.
                      00035 ;
                      00036  
                      00037     include p16f1703.inc
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : May 15 2016
                      00005 ;  MPASM PIC16F1703 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2016 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      01152         LIST
                      00038 
                      00039 ;;;;;;;;;;;;;;
                      00040 ; config  bits
                      00041 ;;;;;;;;;;;;;;
8007   39E4           00042     __config  _CONFIG1, _FOSC_INTOSC & _WDTE_OFF & _PWRTE_OFF & _MCLRE_ON & _CP_OFF & _BOREN_OFF & _CLKO
                            UTEN_OFF
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

8008   1E7F           00043     __config  _CONFIG2, _WRT_OFF & _PPS1WAY_ON & _ZCDDIS_OFF & _PLLEN_OFF & _STVREN_ON & _LPBOR_OFF & _L
                            VP_OFF  
                      00044     
                      00045 #define TONE_PIN RA1 ; sortie alarme    
                      00046 #define SERVO_PIN RA2 ; sortie contrôle servo moteur  
                      00047 #define TONE_LAT LATA
                      00048 #define SERVO_LAT LATA    
                      00049 #define TONE_TRIS TRISA
                      00050 #define SERVO_TRIS TRISA
                      00051 #define SERVO_WPU WPUA    
                      00052 #define TONE_WPU WPUA    
                      00053 #define TONE_PIN_PPS RA1PPS
                      00054 #define TONE_OUT_FN  H'C' ; PWM1
                      00055 #define TONE_CCPRL  CCPR1L
                      00056 #define TONE_CCPCON  CCP1CON    
                      00057 #define SERVO_PIN_PPS RA2PPS
                      00058 #define SERVO_OUT_FN H'D'   ; PWM2
                      00059 #define SERVO_CCPRL CCPR2L
                      00060 #define SERVO_CCPCON CCP2CON    
                      00061 #define START_PIN   RA5 ; bouton start sur RA5
                      00062 #define START_TRIS TRISA
                      00063 #define START_PORT PORTA    
                      00064 #define TIMESET_PIN RA4 ; bouton time set sur RA4
                      00065 #define TIMESET_TRIS TRISA    
                      00066 #define TIMESET_PORT PORTA    
                      00067 #define START_IOCN IOCAN ;registre détection transition négative
                      00068 #define START_IOCF IOCAF ;registre indication interruption
                      00069 #define BTN_TRIS TRISA 
                      00070 #define BTN_PORT PORTA    
                      00071 #define BTN_WPU  WPUA    
                      00072 #define DISPLAY PORTC ; port barre de LED
                      00073 #define DISP_TRIS TRISC
                      00074 #define DISP_LAT  LATC
                      00075 #define DISP_WPU  WPUC
                      00076     
                      00077 ; broches des anodes LED    
                      00078 #define A1      RC0
                      00079 #define A2      RC0
                      00080 #define A3      RC0    
                      00081 #define A4      RC1
                      00082 #define A5      RC1
                      00083 #define A6      RC1    
                      00084 #define A7      RC2
                      00085 #define A8      RC2
                      00086 #define A9      RC2    
                      00087 #define A10     RC3    
                      00088 ; broches des cathodes LED    
                      00089 #define C1      RC5
                      00090 #define C2      RC4
                      00091 #define C3      RC3
                      00092 #define C4      RC5
                      00093 #define C5      RC4
                      00094 #define C6      RC3
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00095 #define C7      RC5
                      00096 #define C8      RC4
                      00097 #define C9      RC3
                      00098 #define C10     RC2
                      00099 ;indicateurs booléens 
                      00100 #define F_SEC    0 ; minuterie seconde 1=active, 0=inactive
                      00101 #define F_MSEC4  1 ; minuterie msec4 1=active, 0=inactive    
                      00102 
                      00103 #define ALARM_TABLE  SOLDOMI    
                      00104 
                      00105 ;#define DEBUG  
                      00106     
                      00107 ;;;;;;;;;;;;;;    
                      00108 ; constantes
                      00109 ;;;;;;;;;;;;;;
  000E                00110     constant F8MHZ=0xE ; valeur de OSCCON:IRCF pour 8Mhz
  000C                00111     constant F2MHZ=0xC ; valeur de OSSCCON:IRCF pour 2Mhz
  0EA6                00112     constant TIME_INCR = .15000/.4 ; incrément de 15 secondes
  927C                00113     constant TIME_MAX = TIME_INCR*.10 ; 150 secondes
  0006                00114     constant TMR0_DLY=.256-.250      ; compte pour TMR0
  8300                00115     constant TMR1_DLY=.65536-.32000  ; compte pour TMR1H:TMR1L
  009B                00116     constant SERVO_PERIOD=.155       ; compte pour PR2
  0035                00117     constant SERVO_POS_BAS=.53      ; compte pour CCP2RL:CCP2CON:DC2B
  002F                00118     constant SERVO_NEUTRAL_PULSE=.47 ; "
  003B                00119     constant SERVO_POS_HAUT=.59      ; "
  0003                00120     constant SERVO_DLY=.3  ; contrôle vitesse de rotation
                      00121 ;;;;;;;;;;;;;;    
                      00122 ; macros    
                      00123 ;;;;;;;;;;;;;;
                      00124 ; macros pour la gestion de la pile des arguments
                      00125 pushw macro ; empile WREG  ( -- n )
                      00126     movwi ++FSR1
                      00127     endm
                      00128     
                      00129 popw macro ; dépile dans WREG ( n -- )
                      00130     moviw FSR1--
                      00131     endm
                      00132 
                      00133 over macro ; copie 2ième élément de la pile  ( n2 n1 - n2 n1 n2)
                      00134     moviw (-1)&0x3f[FSR1]
                      00135     pushw
                      00136     endm
                      00137  
                      00138 dup macro ; copie TOS   ( n -- n n )
                      00139     moviw 0[FSR1]
                      00140     movwi ++FSR1
                      00141     endm
                      00142     
                      00143     
                      00144 ; toutes les pins du port DISP_PORT sont mises en mode entrée
                      00145 ; avec weak pullup actif
                      00146 display_disable macro
                      00147     movlw 0x3f
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00148     banksel DISP_TRIS
                      00149     movwf DISP_TRIS
                      00150     banksel DISP_WPU
                      00151     movwf DISP_WPU
                      00152     endm
                      00153 
                      00154 ; désactivation des weak pullup pour ne pas interférer avec
                      00155 ; le charlieplexing.
                      00156 display_enable macro
                      00157     banksel DISP_WPU
                      00158     clrf DISP_WPU
                      00159     endm
                      00160 
                      00161 
                      00162 ; le canal PWM de l'alarme est désactivé.
                      00163 ; les broches TONE_PIN et ENV_PIN misent en mode entrée avec
                      00164 ; weak pullup
                      00165 alarm_disable macro
                      00166     banksel TONE_TRIS ; tous les TRISx sont dans la même banque
                      00167     bsf TONE_TRIS, TONE_PIN
                      00168     bsf ENV_TRIS, ENV_PIN
                      00169     banksel TONE_WPU  ; tous les WPUx sont dans la même banque
                      00170     bsf TONE_WPU, TONE_PIN
                      00171     bsf ENV_WPU, ENV_PIN
                      00172     banksel TONE_CON
                      00173     bcf TONE_CON, TONE_OE ; désactive sortie PWM
                      00174     endm
                      00175     
                      00176 ;;;;;;;;;;;;;;
                      00177 ; variables
                      00178 ;;;;;;;;;;;;;;
                      00179     udata
0000                  00180 stack res 16
                      00181  
                      00182     udata_shr
                      00183 ; 2 accumulateur 16 bits
0000                  00184 ACAL res 1   ; accumulateur A octet poids faible
0001                  00185 ACAH res 1  ; accumulateur A octet poids fort
0002                  00186 ACBL res 1  ; accumulateur B  octet poids faible
0003                  00187 ACBH res 1  ; accumulateur B  octet poids fort
0004                  00188 trempage res 1 ; durée du trempage en secondes 
0005                  00189 secondes res 1 ; compte à rebours secondes, interruption TIMER1
0006                  00190 msec4 res 1 ; compte à rebours décrément 4 msec, interruption TIMER0
0007                  00191 pwm_period res 1 ; période pour contrôler l'intensité du segment LED 
0008                  00192 flags res 1; indicateurs booléens.
0009                  00193 temp res 1 ; variable temporaire 
000A                  00194 last_pos res 1 ; dernière commande envoyée au servo-moteur 
                      00195 ;;;;;;;;;;;;;;
                      00196 ; code
                      00197 ;;;;;;;;;;;;;;
                      00198     code 
                      00199     org 0
                      00200 ; vecteur reset    
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000                  00201 rst:
0000   2???           00202     goto init
0001   0000           00203     nop
0002   0000           00204     nop
0003   0000           00205     nop
                      00206 ; service des interruptions    
                      00207     org 4
0004                  00208 isr:
0004   1E8B           00209     btfss INTCON, T0IE
0005   3???           00210     bra test_tmr1
0006   190B           00211     btfsc INTCON, T0IF
0007   3???           00212     bra isr_timer0
0008                  00213 test_tmr1:
0008   1F0B           00214     btfss INTCON, PEIE
0009   3???           00215     bra isr_exit ; interruption non traitée.
000A   0020           00216     banksel PIR1
000B   1C11           00217     btfss PIR1, TMR1IF
000C   3???           00218     bra isr_exit ; interuption non traité
000D                  00219 isr_timer1: ; répond à l'interuption sur TIMER1, intervalle 1 secondes
000D   1011           00220     bcf PIR1, TMR1IF
000E   0020           00221     banksel TMR1L
000F   3000           00222     movlw low TMR1_DLY
0010   0096           00223     movwf TMR1L
0011   3083           00224     movlw high TMR1_DLY
0012   0097           00225     movwf TMR1H
0013   0B??           00226     decfsz secondes,F
0014   3???           00227     bra isr_exit
                      00228 ; minuterie expiré désactive interuption
0015   1000           00229     bcf flags, F_SEC
0016   0021           00230     banksel PIE1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0017   1011           00231     bcf PIE1,TMR1IE
0018   130B           00232     bcf INTCON, PEIE
0019   1E8B           00233     btfss INTCON, T0IE ; déscative toutes interruption
001A   0020           00234     banksel T1CON
001B   1018           00235     bcf T1CON, TMR1ON  ; arrête TIMER1
001C   138B           00236     bcf INTCON, GIE    ; si TIMER0 n'est pas en cours d'utilisation
001D   3???           00237     bra isr_exit
001E                  00238 isr_timer0: ; répond à l'innterruption sur TIMER0, intervalle 4 msec.   
001E   0020           00239     banksel TMR0
001F   3006           00240     movlw TMR0_DLY
0020   0095           00241     movwf TMR0
0021   110B           00242     bcf INTCON,T0IF
0022   0B??           00243     decfsz msec4,F
0023   3???           00244     bra isr_exit
0024                  00245 disable_timer:    
0024   1080           00246     bcf flags, F_MSEC4
0025   128B           00247     bcf INTCON,T0IE
0026   1F0B           00248     btfss INTCON, PEIE
0027   138B           00249     bcf INTCON, GIE   ;si TIMER1 n'est pas utilisé présentiment
0028                  00250 isr_exit:    
0028   0009           00251     retfie
                      00252     
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0029                  00253 init:
                      00254 ; fréquence clock à 8Mhz
0029   0021           00255     banksel OSCCON
002A   3070           00256     movlw F8MHZ<<IRCF0  ; Fosc 8Mhz
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002B   0099           00257     movwf OSCCON
                      00258 ; initialisation pointeur de la pile des arguments
002C   30??           00259     movlw high stack
002D   0087           00260     movwf FSR1H
002E   30??           00261     movlw low stack
002F   0086           00262     movwf FSR1L
                      00263 ; assignation des périphériques au broches
                      00264 ; PWM1 sur TONE_PIN   
0030   003D           00265     banksel TONE_PIN_PPS
0031   300C           00266     movlw TONE_OUT_FN  ; fonction PWM1 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0032   0091           00267     movwf TONE_PIN_PPS   
                      00268 ; PWM2 sur SERVO_PIN
0033   003D           00269     banksel SERVO_PIN_PPS
0034   300D           00270     movlw SERVO_OUT_FN  ; fonction PWM2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0035   0092           00271     movwf SERVO_PIN_PPS
                      00272 ; veroullage PPS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0036   140F           00273     bsf PPSLOCK, 0
                      00274 ; activation low power sleep mode
0037   0023           00275     banksel VREGCON
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0038   1497           00276     bsf VREGCON, VREGPM
                      00277 ; enlever weak pullup sur broche sortie TONE
0039   0024           00278     banksel TONE_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
003A   108C           00279     bcf TONE_WPU,TONE_PIN
                      00280 ; entrée analogique non utilisée
003B   0023           00281     banksel ANSELA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
003C   018C           00282     clrf ANSELA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
003D   018E           00283     clrf ANSELC
                      00284 ;    display_disable
                      00285 ; configuration OPTION_REG TIMER0 prescale 64
003E   0021           00286     banksel OPTION_REG
003F   3004           00287     movlw 4 ; TIMER0 préscale 1:32
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0040   0095           00288     movwf OPTION_REG
                      00289 ; met SERVO_PIN en sortie bas voltage
0041   0021           00290     banksel SERVO_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0042   110C           00291     bcf SERVO_TRIS, SERVO_PIN
0043   0022           00292     banksel SERVO_LAT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0044   110C           00293     bcf SERVO_LAT, SERVO_PIN
                      00294 ;variables à zéro
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0045   01??           00295     clrf flags 
0046   01??           00296     clrf secondes
0047   01??           00297     clrf msec4
0048   303B           00298     movlw SERVO_POS_HAUT
0049   00??           00299     movwf last_pos
004A   2???           00300     call self_test
                      00301 
004B                  00302 main:
                      00303 ; activation interruption sur bouton START enfoncé
                      00304 ; ceci pour permettre la sortie du mode SLEEP en enfoncant ce bouton    
004B   0027           00305     banksel START_IOCF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
004C   1293           00306     bcf START_IOCF, START_PIN ; remise à zéro indicateur interruption
004D   0027           00307     banksel START_IOCN
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
004E   1692           00308     bsf START_IOCN, START_PIN ;déclenchement interruption sur transition négative
004F   158B           00309     bsf INTCON, IOCIE  ; activation interruption sur transition broche.
0050   0063           00310     sleep
                      00311 ;désactivation IOCN
0051   118B           00312     bcf INTCON, IOCIE
0052   0027           00313     banksel START_IOCN
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0053   1292           00314     bcf START_IOCN,START_PIN
                      00315 ; tonalité d'éveil
0054   3014           00316     movlw .20
                      00317     pushw
0055   001C               M     movwi ++FSR1
0056   3001           00318     movlw 1
                      00319     pushw
0057   001C               M     movwi ++FSR1
0058   2???           00320     call tone
                      00321 ; ajustement du temps
0059   2???           00322     call timeset
                      00323 ; descente du sachet dans la tasse
005A   3035           00324     movlw SERVO_POS_BAS 
005B   2???           00325     call servo_pos
                      00326 ;   attend expiration de la minuterie
                      00327 ;   avec mise à jour de LED_BAR    
005C   2???           00328     call infusion
                      00329 ;   minuterie  expirée soulève le sachet    
005D   303B           00330     movlw SERVO_POS_HAUT
005E   2???           00331     call servo_pos
                      00332 ;   sonne l'alarme
005F   2???           00333     call alarm
                      00334 ; lorsque la séquence est terminée retourne en sommeil
0060   3???           00335     bra main
                      00336     
                      00337     
                      00338 ;l'utilisateur doit ajuster le temps de trempage    
0061                  00339 timeset:
0061   01??           00340     clrf trempage
0062   0020           00341     banksel BTN_PORT
                      00342 ; attend qu'un bouton soit enfoncé.
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0063                  00343 timeset_wait_btn:   
                      00344     display_enable
0063   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0064   018E               M     clrf DISP_WPU
0065   3064           00345     movlw .100
0066   2???           00346     call pause_msec
0067   080C           00347     movfw BTN_PORT
0068   3930           00348     andlw (1<<START_PIN)|(1<<TIMESET_PIN)
0069   3A30           00349     xorlw (1<<START_PIN)|(1<<TIMESET_PIN)
006A   1903           00350     skpnz
006B   3???           00351     bra $-4
006C   1A09           00352     btfsc WREG,TIMESET_PIN
006D   3???           00353     bra add_time
006E   1A89           00354     btfsc WREG, START_PIN
006F   3???           00355     bra timeset_exit
0070   3???           00356     bra timeset_wait_btn
0071                  00357 add_time:
0071   300F           00358     movlw .15
Message[305]: Using default destination of 1 (file).
0072   07??           00359     addwf trempage
0073   3097           00360     movlw .151
0074   02??           00361     subwf trempage,W
0075   1803           00362     skpnc
0076   01??           00363     clrf trempage
0077   2???           00364     call beep
0078   08??           00365     movfw trempage
0079   2???           00366     call div15
007A   2???           00367     call light_segment
007B   3???           00368     bra timeset_wait_btn
007C                  00369 timeset_exit:
                      00370     display_disable
007C   303F               M     movlw 0x3f
007D   0021               M     banksel DISP_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
007E   008E               M     movwf DISP_TRIS
007F   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0080   008E               M     movwf DISP_WPU
0081   2???           00371     call beep
                      00372 ; attend relâchement du bouton    
0082   0020           00373     banksel BTN_PORT
0083   1E8C           00374     btfss BTN_PORT, START_PIN
0084   3???           00375     bra $-1
0085   0008           00376     return
                      00377 
                      00378 ; son court    
0086                  00379 beep:
0086   300A           00380     movlw .10
                      00381     pushw
0087   001C               M     movwi ++FSR1
0088   0103           00382     clrw
                      00383     pushw
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0089   001C               M     movwi ++FSR1
008A   2???           00384     call tone
008B   0008           00385     return
                      00386     
                      00387 ;  attend expiration de la minuterie
                      00388 ;  mise à jour affichage
                      00389 #define RESTE ACAL    
008C                  00390 infusion:
008C   08??           00391     movfw trempage
008D   1903           00392     skpnz
008E   3???           00393     bra timeout
008F   2???           00394     call start_timer
                      00395     display_enable
0090   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0091   018E               M     clrf DISP_WPU
0092                  00396 wait_loop:
0092   0020           00397     banksel BTN_PORT
0093   1E8C           00398     btfss BTN_PORT, START_PIN ; cancellation si bouton enfoncé
0094   3???           00399     bra cancellation
0095   1C00           00400     btfss flags, F_SEC
0096   3???           00401     bra timeout
0097   08??           00402     movfw secondes
0098   2???           00403     call div15
0099   00??           00404     movwf temp
009A   08??           00405     movf RESTE,F
009B   1903           00406     skpnz
009C   3???           00407     bra $+3
Message[305]: Using default destination of 1 (file).
009D   0A??           00408     incf temp
009E   3???           00409     bra $+3
009F   300F           00410     movlw 0xf
00A0   00??           00411     movwf RESTE
                      00412 ; initialise période pour PWM intensité LED
00A1   300F           00413     movlw 0xf
00A2   00??           00414     movwf pwm_period
00A3                  00415 pwm_loop:
00A3   08??           00416     movf RESTE,F
00A4   1903           00417     skpnz
00A5   01??           00418     clrf temp
00A6   08??           00419     movfw temp
00A7   2???           00420     call light_segment
00A8   08??           00421     movf RESTE,F
00A9   1D03           00422     skpz
00AA   03??           00423     decf RESTE,F
Message[305]: Using default destination of 1 (file).
00AB   03??           00424     decf pwm_period
00AC   1D03           00425     skpz
00AD   3???           00426     bra pwm_loop
00AE   3???           00427     bra wait_loop
00AF                  00428 cancellation:
00AF   1000           00429     bcf flags, F_SEC
00B0   128B           00430     bcf INTCON, T0IE
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B1   01??           00431     clrf secondes
00B2                  00432 timeout:    
                      00433     display_disable
00B2   303F               M     movlw 0x3f
00B3   0021               M     banksel DISP_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00B4   008E               M     movwf DISP_TRIS
00B5   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00B6   008E               M     movwf DISP_WPU
00B7   0008           00434     return
                      00435 
                      00436 
                      00437 ; sonne l'alarme de fin de trempage    
00B8                  00438 alarm:
                      00439 ; initialition pointeur table CE3K
00B8   30??           00440     movlw high ALARM_TABLE
00B9   0085           00441     movwf FSR0H
00BA   1785           00442     bsf FSR0H,7
00BB   30??           00443     movlw low ALARM_TABLE
00BC   0084           00444     movwf FSR0L
00BD   0012           00445     moviw FSR0++
                      00446     pushw ;nombre de notes à jouer
00BE   001C               M     movwi ++FSR1
                      00447 ;sauvegarde du pointeur
00BF   0804           00448     movfw FSR0L
00C0   00??           00449     movwf ACAL
00C1   0805           00450     movfw FSR0H
00C2   00??           00451     movwf ACAH
00C3                  00452 alarm_loop:
                      00453 ;restauration du pointeur    
00C3   08??           00454     movfw ACAL
00C4   0084           00455     movwf FSR0L
00C5   08??           00456     movfw ACAH
00C6   0085           00457     movwf FSR0H
00C7   0012           00458     moviw FSR0++
                      00459     pushw  ; durée note
00C8   001C               M     movwi ++FSR1
00C9   0012           00460     moviw FSR0++
                      00461     pushw  ; indice note
00CA   001C               M     movwi ++FSR1
                      00462 ;sauvegarde du pointeur    
00CB   0804           00463     movfw FSR0L
00CC   00??           00464     movwf ACAL
00CD   0805           00465     movfw FSR0H
00CE   00??           00466     movwf ACAH
00CF   2???           00467     call tone
Message[305]: Using default destination of 1 (file).
00D0   0B81           00468     decfsz INDF1
00D1   3???           00469     bra alarm_loop
                      00470     popw
00D2   0017               M     moviw FSR1--
00D3   0008           00471     return
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00472 
                      00473 ; fait entendre une tonalité
                      00474 ; entrée:  pile ( d n -- )
                      00475 ;    d -> durée en multiple de 4 msec.
                      00476 ;    n -> indice de la note dans la table SCALE    
00D4                  00477 tone:
                      00478 ; prépare FSR0 pour accéder table SCALE
00D4   30??           00479     movlw high SCALE
00D5   0085           00480     movwf FSR0H
00D6   1785           00481     bsf FSR0H,7
00D7   30??           00482     movlw low SCALE
00D8   0084           00483     movwf FSR0L
                      00484 ;ajoute l'indice de la note à FSR0    
                      00485     popw
00D9   0017               M     moviw FSR1--
Message[305]: Using default destination of 1 (file).
00DA   0784           00486     addwf FSR0L
00DB   3F00           00487     moviw 0[FSR0]
00DC   0020           00488     banksel PR2
00DD   009B           00489     movwf PR2  ;la valeur retirée de SCALE détermine la période PWM
                      00490     pushw       ;sauvegarde sur la pile temporairement
00DE   001C               M     movwi ++FSR1
Message[305]: Using default destination of 1 (file).
00DF   3689           00491     lsrf WREG   ; cette valeur divisé par 2 va dans CCPxL
00E0   0025           00492     banksel TONE_CCPRL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00E1   0091           00493     movwf TONE_CCPRL   ; les 6 bits les plus significatifs du rapport cyclique
                      00494     popw
00E2   0017               M     moviw FSR1--
00E3   3901           00495     andlw 1    ; les 2 bites les moins significatifs du rapport cyclique
Message[305]: Using default destination of 1 (file).
00E4   3589           00496     lslf WREG
Message[305]: Using default destination of 1 (file).
00E5   0E89           00497     swapf WREG ; dans bits 4 et 5 de CCPxCON
00E6   380C           00498     iorlw (3<<CCP1M2) ; mode PWM
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00E7   0093           00499     movwf TONE_CCPCON  ; PWM configuré
                      00500 ; configuration de la sortie pour le PWM
00E8   0021           00501     banksel TONE_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00E9   108C           00502     bcf TONE_TRIS, TONE_PIN ; broche en mode sortie
                      00503 ; activation minuterie TIMER2
00EA   0020           00504     banksel T2CON
00EB   3006           00505     movlw (2<<T2CKPS0)|(1<<TMR2ON)
00EC   009C           00506     movwf T2CON ; préscale 16 et TIMER2 on.
                      00507     popw     ; durée
00ED   0017               M     moviw FSR1--
00EE   2???           00508     call pause_msec  
                      00509 ;désactive tone pwm
                      00510 ;arrête TIMER2
00EF   0020           00511     banksel T2CON
00F0   111C           00512     bcf T2CON, TMR2ON
00F1   0025           00513     banksel TONE_CCPCON
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00F2   0193           00514     clrf TONE_CCPCON
00F3   0021           00515     banksel TONE_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00F4   148C           00516     bsf TONE_TRIS, TONE_PIN
00F5   0008           00517     return
                      00518     
                      00519 ; allume un segment de la barre LED
                      00520 ; entrée:
                      00521 ;   W contient le numéro du segment
                      00522 ;   à allumer
00F6                  00523 light_segment:
                      00524     pushw
00F6   001C               M     movwi ++FSR1
                      00525 ; initialise FSR0 pour pointer sur la table LED_CON
00F7   30??           00526     movlw high LED_CONN
00F8   0085           00527     movwf FSR0H
00F9   1785           00528     bsf FSR0H, 7
00FA   30??           00529     movlw low LED_CONN
00FB   0084           00530     movwf FSR0L
                      00531     popw
00FC   0017               M     moviw FSR1--
Message[305]: Using default destination of 1 (file).
00FD   3589           00532     lslf WREG   ; segment * 2
Message[305]: Using default destination of 1 (file).
00FE   0784           00533     addwf FSR0L ; ajuste le pointeur de table
00FF   0800           00534     movfw INDF0  ; obtient valeur sortie PORT
0100   0022           00535     banksel DISP_LAT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0101   008E           00536     movwf DISP_LAT
Message[305]: Using default destination of 1 (file).
0102   0A84           00537     incf FSR0L
0103   0800           00538     movfw INDF0  ; obtient valeur TRIS
0104   0021           00539     banksel DISP_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0105   008E           00540     movwf DISP_TRIS
0106   0008           00541     return
                      00542 
                      00543 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00544 ; commande la position du servo-moteur
                      00545 ; NOTE:
                      00546     ; la fréquence de l'oscillateur est descendue à 2Mhz pour
                      00547     ; permettre une période de 20msec avec T2
                      00548     ; le préscale de T2 est programmé à 1/64
                      00549     ; la période T=(PR2+1)*4*Tosc*PS=156*4*5e-7*64=0,019968
                      00550     ; la résolution est de Tosc*64=5e-7*64/4=32µSec
                      00551 ;  entrée:
                      00552 ;      W contient la valeur de contrôle
                      00553 ;  valeur comprise entre SERVO_POS_BAS et SERVO_POS_HAUT
                      00554 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;    
0107                  00555 servo_pos:
                      00556     pushw
0107   001C               M     movwi ++FSR1
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00557 ; contrôle des limites    
0108   3035           00558     movlw SERVO_POS_BAS
0109   0201           00559     subwf INDF1,W
010A   3035           00560     movlw SERVO_POS_BAS
010B   1C03           00561     skpc
010C   0081           00562     movwf INDF1
010D   303B           00563     movlw SERVO_POS_HAUT
010E   0201           00564     subwf INDF1,W
010F   303B           00565     movlw SERVO_POS_HAUT
0110   1803           00566     skpnc
0111   0081           00567     movwf INDF1
                      00568 ; pour obtenir une période de 50 Hertz sur TIMER2 il faut réduire
                      00569 ; Fosc à 2Mhz
0112   0021           00570     banksel OSCCON
0113   3060           00571     movlw F2MHZ<<IRCF0   ; Fosc=2Mhz
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0114   0099           00572     movwf OSCCON
                      00573 ; configuration TIMER2 pour période 20 msec
0115   0020           00574     banksel T2CON
0116   309B           00575     movlw SERVO_PERIOD ; 20msec
0117   009B           00576     movwf PR2
0118   3007           00577     movlw (3<<T2CKPS0)|(1<<TMR2ON)
0119   009C           00578     movwf T2CON
                      00579 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;    
                      00580 ; pour contrôler la vitesse de rotation
                      00581 ; on part de valeur de l'ancienne commande
                      00582 ; en progressant vers la nouvelle valeur    
                      00583 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;    
                      00584 ;durée du pulse 8 bits les plus significatifs dans CCP2RL et les 
                      00585 ;2 moins significatifs dans CCP2CON:4,5
011A                  00586 servo_pos_loop:
011A   0025           00587     banksel SERVO_CCPCON
011B   36??           00588     lsrf last_pos,W
Message[305]: Using default destination of 1 (file).
011C   3689           00589     lsrf WREG
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011D   0098           00590     movwf SERVO_CCPRL
011E   0E??           00591     swapf last_pos,W
011F   3930           00592     andlw (3<<4)
0120   380C           00593     iorlw 3<<CCP2M2  ; mode PWM
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0121   009A           00594     movwf SERVO_CCPCON
                      00595 ; attend la fin du cycle
0122   3003           00596     movlw SERVO_DLY
0123   00??           00597     movwf ACAL
0124                  00598 delay:
0124   0020           00599     banksel PIR1
0125   1091           00600     bcf PIR1,TMR2IF
0126   1C91           00601     btfss PIR1,TMR2IF
0127   3???           00602     bra $-1
0128   0B??           00603     decfsz ACAL,F
0129   3???           00604     bra delay
012A   0801           00605     movfw INDF1
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012B   02??           00606     subwf last_pos,W
012C   1903           00607     skpnz
012D   3???           00608     bra servo_pos_exit
012E   0801           00609     movfw INDF1
012F   02??           00610     subwf last_pos,W
0130   1C03           00611     skpc
0131   0A??           00612     incf last_pos,F
0132   1803           00613     skpnc
0133   03??           00614     decf last_pos,F
0134   3???           00615     bra servo_pos_loop
0135                  00616 servo_pos_exit:  
                      00617     popw
0135   0017               M     moviw FSR1--
                      00618 ;arret de la commande
                      00619 ;attend la fin du cycle PWM
0136   0020           00620     banksel PR2
0137   081B           00621     movfw PR2
0138   021A           00622     subwf TMR2,W
0139   1C03           00623     skpc
013A   3???           00624     bra $-3
013B   0025           00625     banksel SERVO_CCPCON
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
013C   019A           00626     clrf SERVO_CCPCON
013D   0020           00627     banksel T2CON
013E   111C           00628     bcf T2CON, TMR2ON
                      00629 ;remet Fosc à 8Mhz    
013F   0021           00630     banksel OSCCON
0140   3070           00631     movlw F8MHZ<<IRCF0  ; Fosc=8Mhz
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0141   0099           00632     movwf OSCCON
0142   0008           00633     return
                      00634     
                      00635 ; division non signée entier 8 bits par 15
                      00636 ; entrée:
                      00637 ;   dividende dans W
                      00638 ;sortie:
                      00639 ;   quotient dans ACAH
                      00640 ;   reste dans ACAL    
                      00641 #define DIVIDENDE ACAL    
                      00642 #define QUOTIENT ACAH
                      00643 #define DIVISEUR ACBL    
0143                  00644 div15:
0143   01??           00645     clrf QUOTIENT
0144   3A00           00646     xorlw 0
0145   1903           00647     skpnz
0146   3???           00648     bra div15_exit
0147   00??           00649     movwf DIVIDENDE
0148   30F0           00650     movlw 0xF0 ; diviseur<<4
0149   00??           00651     movwf DIVISEUR
014A   02??           00652     subwf DIVIDENDE,W
014B   1C03           00653     skpc
014C   3???           00654     bra div15_1
014D   1600           00655     bsf QUOTIENT,4
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

014E   00??           00656     movwf DIVIDENDE ; conserve reste pour prochaine étape
014F                  00657 div15_1:
Message[305]: Using default destination of 1 (file).
014F   36??           00658     lsrf DIVISEUR
0150   08??           00659     movfw DIVISEUR
0151   02??           00660     subwf DIVIDENDE,W
0152   1C03           00661     skpc
0153   3???           00662     bra div15_2
0154   1580           00663     bsf QUOTIENT,3
0155   00??           00664     movwf DIVIDENDE
0156                  00665 div15_2:
Message[305]: Using default destination of 1 (file).
0156   36??           00666     lsrf DIVISEUR
0157   08??           00667     movfw DIVISEUR
0158   02??           00668     subwf DIVIDENDE,W
0159   1C03           00669     skpc
015A   3???           00670     bra div15_3
015B   1500           00671     bsf QUOTIENT,2
015C   00??           00672     movwf DIVIDENDE
015D                  00673 div15_3:
Message[305]: Using default destination of 1 (file).
015D   36??           00674     lsrf DIVISEUR
015E   08??           00675     movfw DIVISEUR
015F   02??           00676     subwf DIVIDENDE,W
0160   1C03           00677     skpc
0161   3???           00678     bra div15_4
0162   1480           00679     bsf QUOTIENT,1
0163   00??           00680     movwf DIVIDENDE
0164                  00681 div15_4:
Message[305]: Using default destination of 1 (file).
0164   36??           00682     lsrf DIVISEUR
0165   08??           00683     movfw DIVISEUR
0166   02??           00684     subwf DIVIDENDE,W
0167   1803           00685     skpnc
0168   1400           00686     bsf QUOTIENT,0
0169                  00687 div15_exit:
0169   08??           00688     movfw QUOTIENT
016A   0008           00689     return
                      00690 
                      00691 ; démarre la minuterie des secondes
                      00692 ; utilisation du TIMER1 avec LFOSC.    
                      00693 ; entrée:
                      00694 ;   W=durée en secondes    
016B                  00695 start_timer:
016B   00??           00696     movwf secondes
016C   0020           00697     banksel TMR1H
016D   3083           00698     movlw high TMR1_DLY
016E   0097           00699     movwf TMR1H
016F   3000           00700     movlw low TMR1_DLY
0170   0096           00701     movwf TMR1L
0171   30C1           00702     movlw (3<<TMR1CS0)|1
0172   0098           00703     movwf T1CON
0173   0020           00704     banksel PIR1
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0174   1011           00705     bcf PIR1, TMR1IF
0175   0021           00706     banksel PIE1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0176   1411           00707     bsf PIE1, TMR1IE
0177   170B           00708     bsf INTCON,PEIE
0178   178B           00709     bsf INTCON,GIE
0179   1400           00710     bsf flags, F_SEC
017A   0008           00711     return
                      00712 
                      00713     
                      00714 ; démarre la minuterie des millisecondes
                      00715 ; entrée:
                      00716 ;    W contient la durée en multiple de 4 msec.
017B                  00717 start_msec4_tmr:
017B   00??           00718     movwf msec4
017C   0020           00719     banksel TMR0
017D   3006           00720     movlw TMR0_DLY
017E   0095           00721     movwf TMR0
017F   110B           00722     bcf INTCON, T0IF
0180   168B           00723     bsf INTCON, T0IE
0181   178B           00724     bsf INTCON, GIE
0182   1480           00725     bsf flags, F_MSEC4
0183   0008           00726     return
                      00727 
                      00728 ;pause en multiple de 4 msec
                      00729 ; entrée:  W -> pause= 4*W msec   
0184                  00730 pause_msec:
0184   2???           00731     call start_msec4_tmr
0185   1880           00732     btfsc flags, F_MSEC4
0186   3???           00733     bra $-1
0187   0008           00734     return
                      00735     
                      00736 ;auto test à l'allumage
                      00737 ; allume tous les segments l'un après l'autre
                      00738 ; test alarme
                      00739 ; test servo-moteur
0188                  00740 self_test:
                      00741     display_enable
0188   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0189   018E               M     clrf DISP_WPU
018A   300A           00742     movlw .10
                      00743     pushw
018B   001C               M     movwi ++FSR1
018C                  00744 disp_test:
018C   3F40           00745     moviw 0[FSR1]
018D   2???           00746     call light_segment
018E   3019           00747     movlw .25
                      00748     pushw
018F   001C               M     movwi ++FSR1
                      00749     over
0190   3F7F               M     moviw (-1)&0x3f[FSR1]
                          M     pushw
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0191   001C               M     movwi ++FSR1
0192   2???           00750     call tone
0193   0B81           00751     decfsz INDF1,F
0194   3???           00752     bra disp_test
                      00753     popw
0195   0017               M     moviw FSR1--
                      00754     display_disable
0196   303F               M     movlw 0x3f
0197   0021               M     banksel DISP_TRIS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0198   008E               M     movwf DISP_TRIS
0199   0024               M     banksel DISP_WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
019A   008E               M     movwf DISP_WPU
019B                  00755 tone_test:
019B   3014           00756     movlw .20
                      00757     pushw
019C   001C               M     movwi ++FSR1
019D   3015           00758     movlw .21
                      00759     pushw
019E   001C               M     movwi ++FSR1
019F   2???           00760     call tone
01A0                  00761 servo_test:
01A0   3035           00762     movlw SERVO_POS_BAS
01A1   2???           00763     call servo_pos
01A2   303B           00764     movlw SERVO_POS_HAUT
01A3   2???           00765     call servo_pos
01A4   0008           00766     return
                      00767     
                      00768     
                      00769 ;;;;;;;;;;;;;;;;
                      00770 ;  tables
                      00771 ;;;;;;;;;;;;;;;;  
                      00772     org  0x700   
                      00773 ; connection des LED
                      00774 ; ordre inversé dans le montage final    
0700                  00775 LED_CONN: ; PORT data, TRIS data
0700   3400 34FF      00776     dt 0, 0xFF ; tous les segments éteints
0702   3408 34F3      00777     dt 1<<A10, ~(1<<C10 | 1<<A10)
0704   3404 34F3      00778     dt 1<<A9, ~(1<<C9 | 1<<A9)
0706   3404 34EB      00779     dt 1<<A8, ~(1<<C8 | 1<<A8)
0708   3404 34DB      00780     dt 1<<A7, ~(1<<C7 | 1<<A7)
070A   3402 34F5      00781     dt 1<<A6, ~(1<<C6 | 1<<A6)
070C   3402 34ED      00782     dt 1<<A5, ~(1<<C5 | 1<<A5)
070E   3402 34DD      00783     dt 1<<A4, ~(1<<C4 | 1<<A4)
0710   3401 34F6      00784     dt 1<<A3, ~(1<<C3 | 1<<A3)
0712   3401 34EE      00785     dt 1<<A2, ~(1<<C2 | 1<<A2)
0714   3401 34DE      00786     dt 1<<A1, ~(1<<C1 | 1<<A1)
0716   3400 34FF      00787     dt 0, 0xFF
0718   3400 34FF      00788     dt 0, 0xFF
071A   3400 34FF      00789     dt 0, 0xFF
071C   3400 34FF      00790     dt 0, 0xFF
071E   3400 34FF      00791     dt 0, 0xFF
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00792 
                      00793 ;valeur de PR2 pour généré tonalités gamme tempéré
0720                  00794 SCALE:
0720   34EE           00795     dt .238 ;0: 523 DO
0721   34E1           00796     dt .225 ;1: 554 DO#
0722   34D4           00797     dt .212 ;2: 587 RÉ
0723   34C8           00798     dt .200 ;3: 622 RÉ#
0724   34BD           00799     dt .189 ;4: 659 MI
0725   34B2           00800     dt .178 ;5: 698 FA
0726   34A8           00801     dt .168 ;6: 740 FA#
0727   349E           00802     dt .158 ;7: 784 SOL
0728   3495           00803     dt .149 ;8: 831 SOL#
0729   348D           00804     dt .141 ;9: 880 LA
072A   3485           00805     dt .133 ;10: 932 LA#
072B   347E           00806     dt .126 ;11: 988 SI
072C   3476           00807     dt .118 ;12: 1047 DO
072D   3470           00808     dt .112 ;13: 1109 DO#
072E   3469           00809     dt .105 ;14: 1175 RÉ
072F   3463           00810     dt .99  ;15: 1245 RÉ#
0730   345E           00811     dt .94  ;16: 1319 MI
0731   3458           00812     dt .88  ;17: 1397 FA
0732   3453           00813     dt .83  ;18: 1480 FA#
0733   344F           00814     dt .79  ;19: 1568 SOL
0734   344A           00815     dt .74  ;20: 1661 SOL#
0735   3446           00816     dt .70  ;21: 1760 LA
0736   3442           00817     dt .66  ;22: 1865 LA#
0737   343F           00818     dt .63  ;23: 1967 SI
0738   343B           00819     dt .59  ;24: 2093 DO
                      00820     
                      00821 ;5 première notes de rencontre du 3ième type
0739                  00822 CE3K:
0739   3406           00823     dt .6 ; nombre de notes
                      00824     ; durée, note
073A   3464 340E      00825     dt .100,.14
073C   3464 3410      00826     dt .100,.16
073E   3464 340C      00827     dt .100,.12
0740   3464 3400      00828     dt .100,.0
0742   34C8 3407      00829     dt .200,.7
0744   34C8 3407      00830     dt .200,.7
                      00831 
                      00832 ; 3 première note de la sonate au clair de lune
                      00833 ; de Beethoven
0746                  00834 SOLDOMI:
0746   3403           00835     dt .3 
0747   3464 3407      00836     dt .100,.7   ;sol
0749   3464 340C      00837     dt .100,.12  ;do
074B   3464 3410      00838     dt .100,.16  ;mi
                      00839     
                      00840     
                      00841 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;    
39E4 1E7F             00842     end
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

A1                                RC0
A10                               RC3
A2                                RC0
A3                                RC0
A4                                RC1
A5                                RC1
A6                                RC1
A7                                RC2
A8                                RC2
A9                                RC2
ACAH                              00000001
ACAL                              00000000
ACBH                              00000003
ACBL                              00000002
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACKTIM                            00000007
ADCON0                            0000009D
ADCON1                            0000009E
ADCON2                            0000009F
ADD0                              00000000
ADD1                              00000001
ADD2                              00000002
ADD3                              00000003
ADD4                              00000004
ADD5                              00000005
ADD6                              00000006
ADD7                              00000007
ADFM                              00000007
ADFVR0                            00000000
ADFVR1                            00000001
ADGO                              00000001
ADIE                              00000006
ADIF                              00000006
ADNREF                            00000002
ADON                              00000000
ADPREF0                           00000000
ADPREF1                           00000001
ADRES                             0000009B
ADRESH                            0000009C
ADRESL                            0000009B
AHEN                              00000001
ALARM_TABLE                       SOLDOMI
ANSA0                             00000000
ANSA1                             00000001
ANSA2                             00000002
ANSA4                             00000004
ANSC0                             00000000
ANSC1                             00000001
ANSC2                             00000002
ANSC3                             00000003
ANSC4                             00000004
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

ANSC5                             00000005
ANSELA                            0000018C
ANSELC                            0000018E
BCL1IE                            00000003
BCL1IF                            00000003
BF                                00000000
BKA10                             00000002
BKA11                             00000003
BKA12                             00000004
BKA13                             00000005
BKA14                             00000006
BKA8                              00000000
BKA9                              00000001
BOEN                              00000004
BORCON                            00000116
BORFS                             00000006
BORRDY                            00000000
BSR                               00000008
BSR0                              00000000
BSR1                              00000001
BSR2                              00000002
BSR3                              00000003
BSR4                              00000004
BSR_SHAD                          00000FE6
BTN_PORT                          PORTA
BTN_TRIS                          TRISA
BTN_WPU                           WPUA
BUF0                              00000000
BUF1                              00000001
BUF2                              00000002
BUF3                              00000003
BUF4                              00000004
BUF5                              00000005
BUF6                              00000006
BUF7                              00000007
C                                 00000000
C1                                RC5
C10                               RC2
C2                                RC4
C3                                RC3
C4                                RC5
C5                                RC4
C6                                RC3
C7                                RC5
C8                                RC4
C9                                RC3
CCP1CON                           00000293
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

CCP1PPS                           00000E14
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000029A
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2PPS                           00000E15
CCP2X                             00000005
CCP2Y                             00000004
CCPIE                             00000002
CCPIF                             00000002
CCPR1                             00000291
CCPR1H                            00000292
CCPR1L                            00000291
CCPR2                             00000298
CCPR2H                            00000299
CCPR2L                            00000298
CDAFVR0                           00000002
CDAFVR1                           00000003
CE3K                              00000739
CFGS                              00000006
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CHS4                              00000006
CKE                               00000006
CKP                               00000004
C_SHAD                            00000000
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DC_SHAD                           00000001
DHEN                              00000000
DISPLAY                           PORTC
DISP_LAT                          LATC
DISP_TRIS                         TRISC
DISP_WPU                          WPUC
DIVIDENDE                         ACAL
DIVISEUR                          ACBL
D_NOT_A                           00000005
ECCP1CON                          00000293
ECCP2CON                          0000029A
F                                 00000001
F2MHZ                             0000000C
F8MHZ                             0000000E
FREE                              00000004
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

FSR0                              00000004
FSR0H                             00000005
FSR0H_SHAD                        00000FE9
FSR0L                             00000004
FSR0L_SHAD                        00000FE8
FSR1                              00000006
FSR1H                             00000007
FSR1H_SHAD                        00000FEB
FSR1L                             00000006
FSR1L_SHAD                        00000FEA
FVRCON                            00000117
FVREN                             00000007
FVRRDY                            00000006
F_MSEC4                           1
F_SEC                             0
GCEN                              00000007
GIE                               00000007
GO                                00000001
GO_NOT_DONE                       00000001
HFIOFL                            00000003
HFIOFR                            00000004
HFIOFS                            00000000
ICDBK0H                           00000F9E
INDF0                             00000000
INDF1                             00000001
INLVLA                            0000038C
INLVLA0                           00000000
INLVLA1                           00000001
INLVLA2                           00000002
INLVLA3                           00000003
INLVLA4                           00000004
INLVLA5                           00000005
INLVLC                            0000038E
INLVLC0                           00000000
INLVLC1                           00000001
INLVLC2                           00000002
INLVLC3                           00000003
INLVLC4                           00000004
INLVLC5                           00000005
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
INTPPS                            00000E10
IOCAF                             00000393
IOCAF0                            00000000
IOCAF1                            00000001
IOCAF2                            00000002
IOCAF3                            00000003
IOCAF4                            00000004
IOCAF5                            00000005
IOCAN                             00000392
IOCAN0                            00000000
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

IOCAN1                            00000001
IOCAN2                            00000002
IOCAN3                            00000003
IOCAN4                            00000004
IOCAN5                            00000005
IOCAP                             00000391
IOCAP0                            00000000
IOCAP1                            00000001
IOCAP2                            00000002
IOCAP3                            00000003
IOCAP4                            00000004
IOCAP5                            00000005
IOCCF                             00000399
IOCCF0                            00000000
IOCCF1                            00000001
IOCCF2                            00000002
IOCCF3                            00000003
IOCCF4                            00000004
IOCCF5                            00000005
IOCCN                             00000398
IOCCN0                            00000000
IOCCN1                            00000001
IOCCN2                            00000002
IOCCN3                            00000003
IOCCN4                            00000004
IOCCN5                            00000005
IOCCP                             00000397
IOCCP0                            00000000
IOCCP1                            00000001
IOCCP2                            00000002
IOCCP3                            00000003
IOCCP4                            00000004
IOCCP5                            00000005
IOCIE                             00000003
IOCIF                             00000000
IRCF0                             00000003
IRCF1                             00000004
IRCF2                             00000005
IRCF3                             00000006
LATA                              0000010C
LATA0                             00000000
LATA1                             00000001
LATA2                             00000002
LATA4                             00000004
LATA5                             00000005
LATC                              0000010E
LATC0                             00000000
LATC1                             00000001
LATC2                             00000002
LATC3                             00000003
LATC4                             00000004
LATC5                             00000005
LED_CONN                          00000700
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 24


SYMBOL TABLE
  LABEL                             VALUE 

LFIOFR                            00000001
LWLO                              00000005
MFIOFR                            00000002
MSK0                              00000000
MSK1                              00000001
MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RI                            00000002
NOT_RMCLR                         00000003
NOT_RWDT                          00000004
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_WPUEN                         00000007
ODA0                              00000000
ODA1                              00000001
ODA2                              00000002
ODA4                              00000004
ODA5                              00000005
ODC0                              00000000
ODC1                              00000001
ODC2                              00000002
ODC3                              00000003
ODC4                              00000004
ODC5                              00000005
ODCONA                            0000028C
ODCONC                            0000028E
OPA1CON                           00000511
OPA1EN                            00000007
OPA1PCH0                          00000000
OPA1PCH1                          00000001
OPA1SP                            00000006
OPA1UG                            00000004
OPA2CON                           00000515
OPA2EN                            00000007
OPA2PCH0                          00000000
OPA2PCH1                          00000001
OPA2SP                            00000006
OPA2UG                            00000004
OPTION_REG                        00000095
OSCCON                            00000099
OSCSTAT                           0000009A
OSCTUNE                           00000098
OSTS                              00000005
P                                 00000004
PCIE                              00000006
PCL                               00000002
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

PCLATH                            0000000A
PCLATH_SHAD                       00000FE7
PCON                              00000096
PEIE                              00000006
PEN                               00000002
PIE1                              00000091
PIE2                              00000092
PIE3                              00000093
PIR1                              00000011
PIR2                              00000012
PIR3                              00000013
PLLR                              00000006
PMADR                             00000191
PMADRH                            00000192
PMADRL                            00000191
PMCON1                            00000195
PMCON2                            00000196
PMDAT                             00000193
PMDATH                            00000194
PMDATL                            00000193
PORTA                             0000000C
PORTC                             0000000E
PPSLOCK                           00000E0F
PPSLOCKED                         00000000
PR2                               0000001B
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
QUOTIENT                          ACAH
RA0                               00000000
RA0PPS                            00000E90
RA1                               00000001
RA1PPS                            00000E91
RA2                               00000002
RA2PPS                            00000E92
RA3                               00000003
RA4                               00000004
RA4PPS                            00000E94
RA5                               00000005
RA5PPS                            00000E95
RC0                               00000000
RC0PPS                            00000EA0
RC1                               00000001
RC1PPS                            00000EA1
RC2                               00000002
RC2PPS                            00000EA2
RC3                               00000003
RC3PPS                            00000EA3
RC4                               00000004
RC4PPS                            00000EA4
RC5                               00000005
RC5PPS                            00000EA5
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

RCEN                              00000003
RD                                00000000
RESTE                             ACAL
RSEN                              00000001
R_NOT_W                           00000002
Reserved                          00000000
S                                 00000003
SBCDE                             00000002
SBOREN                            00000007
SCALE                             00000720
SCIE                              00000005
SCS0                              00000000
SCS1                              00000001
SDAHT                             00000003
SEN                               00000000
SERVO_CCPCON                      CCP2CON
SERVO_CCPRL                       CCPR2L
SERVO_DLY                         00000003
SERVO_LAT                         LATA
SERVO_NEUTRAL_PULSE               0000002F
SERVO_OUT_FN                      H'D'
SERVO_PERIOD                      0000009B
SERVO_PIN                         RA2
SERVO_PIN_PPS                     RA2PPS
SERVO_POS_BAS                     00000035
SERVO_POS_HAUT                    0000003B
SERVO_TRIS                        TRISA
SERVO_WPU                         WPUA
SLRA0                             00000000
SLRA1                             00000001
SLRA2                             00000002
SLRA4                             00000004
SLRA5                             00000005
SLRC0                             00000000
SLRC1                             00000001
SLRC2                             00000002
SLRC3                             00000003
SLRC4                             00000004
SLRC5                             00000005
SLRCONA                           0000030C
SLRCONC                           0000030E
SMP                               00000007
SOLDOMI                           00000746
SOSCR                             00000007
SPLLEN                            00000007
SSP1ADD                           00000212
SSP1ADD0                          00000000
SSP1ADD1                          00000001
SSP1ADD2                          00000002
SSP1ADD3                          00000003
SSP1ADD4                          00000004
SSP1ADD5                          00000005
SSP1ADD6                          00000006
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

SSP1ADD7                          00000007
SSP1BUF                           00000211
SSP1BUF0                          00000000
SSP1BUF1                          00000001
SSP1BUF2                          00000002
SSP1BUF3                          00000003
SSP1BUF4                          00000004
SSP1BUF5                          00000005
SSP1BUF6                          00000006
SSP1BUF7                          00000007
SSP1CON                           00000215
SSP1CON1                          00000215
SSP1CON2                          00000216
SSP1CON3                          00000217
SSP1IE                            00000003
SSP1IF                            00000003
SSP1MSK                           00000213
SSP1MSK0                          00000000
SSP1MSK1                          00000001
SSP1MSK2                          00000002
SSP1MSK3                          00000003
SSP1MSK4                          00000004
SSP1MSK5                          00000005
SSP1MSK6                          00000006
SSP1MSK7                          00000007
SSP1STAT                          00000214
SSPADD                            00000212
SSPBUF                            00000211
SSPCLKPPS                         00000E20
SSPCON                            00000215
SSPCON1                           00000215
SSPCON2                           00000216
SSPCON3                           00000217
SSPDATPPS                         00000E21
SSPEN                             00000005
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000213
SSPOV                             00000006
SSPSSPPS                          00000E22
SSPSTAT                           00000214
START_IOCF                        IOCAF
START_IOCN                        IOCAN
START_PIN                         RA5
START_PORT                        PORTA
START_TRIS                        TRISA
STATUS                            00000003
STATUS_SHAD                       00000FE4
STKOVF                            00000007
STKPTR                            00000FED
STKUNF                            00000006
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 28


SYMBOL TABLE
  LABEL                             VALUE 

SWDTEN                            00000000
T0CKIPPS                          00000E11
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKIPPS                          00000E12
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000018
T1GCON                            00000019
T1GGO_NOT_DONE                    00000003
T1GPOL                            00000006
T1GPPS                            00000E13
T1GSPM                            00000004
T1GSS0                            00000000
T1GSS1                            00000001
T1GTM                             00000005
T1GVAL                            00000002
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             0000001C
T2OUTPS0                          00000003
T2OUTPS1                          00000004
T2OUTPS2                          00000005
T2OUTPS3                          00000006
TIMESET_PIN                       RA4
TIMESET_PORT                      PORTA
TIMESET_TRIS                      TRISA
TIME_INCR                         00000EA6
TIME_MAX                          0000927C
TMR0                              00000015
TMR0CS                            00000005
TMR0IE                            00000005
TMR0IF                            00000002
TMR0SE                            00000004
TMR0_DLY                          00000006
TMR1                              00000016
TMR1CS0                           00000006
TMR1CS1                           00000007
TMR1GE                            00000007
TMR1GIE                           00000007
TMR1GIF                           00000007
TMR1H                             00000017
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             00000016
TMR1ON                            00000000
TMR1_DLY                          00008300
TMR2                              0000001A
TMR2IE                            00000001
TMR2IF                            00000001
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 29


SYMBOL TABLE
  LABEL                             VALUE 

TMR2ON                            00000002
TONE_CCPCON                       CCP1CON
TONE_CCPRL                        CCPR1L
TONE_LAT                          LATA
TONE_OUT_FN                       H'C'
TONE_PIN                          RA1
TONE_PIN_PPS                      RA1PPS
TONE_TRIS                         TRISA
TONE_WPU                          WPUA
TOSH                              00000FEF
TOSL                              00000FEE
TRIGSEL0                          00000004
TRIGSEL1                          00000005
TRIGSEL2                          00000006
TRIGSEL3                          00000007
TRISA                             0000008C
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA4                            00000004
TRISA5                            00000005
TRISC                             0000008E
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TSEN                              00000005
TSRNG                             00000004
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
UA                                00000001
VREGCON                           00000197
VREGPM                            00000001
W                                 00000000
WCOL                              00000007
WDTCON                            00000097
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WDTPS4                            00000005
WPUA                              0000020C
WPUA0                             00000000
WPUA1                             00000001
WPUA2                             00000002
WPUA3                             00000003
WPUA4                             00000004
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 30


SYMBOL TABLE
  LABEL                             VALUE 

WPUA5                             00000005
WPUC                              0000020E
WPUC0                             00000000
WPUC1                             00000001
WPUC2                             00000002
WPUC3                             00000003
WPUC4                             00000004
WPUC5                             00000005
WR                                00000001
WREG                              00000009
WREG_SHAD                         00000FE5
WREN                              00000002
WRERR                             00000003
Z                                 00000002
ZCD1CON                           0000011C
ZCD1EN                            00000007
ZCD1INTN                          00000000
ZCD1INTP                          00000001
ZCD1OUT                           00000005
ZCD1POL                           00000004
ZCDIE                             00000004
ZCDIF                             00000004
Z_SHAD                            00000002
_.org_1_006B                      0000006B
_.org_1_0084                      00000084
_.org_1_009C                      0000009C
_.org_1_009E                      0000009E
_.org_1_0127                      00000127
_.org_1_013A                      0000013A
_.org_1_0186                      00000186
_BOREN_NSLEEP                     00003DFF
_BOREN_OFF                        000039FF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003BFF
_BORV_HI                          00003BFF
_BORV_LO                          00003FFF
_CLKOUTEN_OFF                     00003FFF
_CLKOUTEN_ON                      000037FF
_CONFIG1                          00008007
_CONFIG2                          00008008
_CP_OFF                           00003FFF
_CP_ON                            00003F7F
_DEVID1                           00008006
_FOSC_ECH                         00003FFF
_FOSC_ECL                         00003FFD
_FOSC_ECM                         00003FFE
_FOSC_INTOSC                      00003FFC
_IDLOC0                           00008000
_IDLOC1                           00008001
_IDLOC2                           00008002
_IDLOC3                           00008003
_LPBOR_OFF                        00003FFF
_LPBOR_ON                         000037FF
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 31


SYMBOL TABLE
  LABEL                             VALUE 

_LVP_OFF                          00001FFF
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FBF
_MCLRE_ON                         00003FFF
_PLLEN_OFF                        00003EFF
_PLLEN_ON                         00003FFF
_PPS1WAY_OFF                      00003FFB
_PPS1WAY_ON                       00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FDF
_STVREN_OFF                       00003DFF
_STVREN_ON                        00003FFF
_WDTE_NSLEEP                      00003FF7
_WDTE_OFF                         00003FE7
_WDTE_ON                          00003FFF
_WDTE_SWDTEN                      00003FEF
_WRT_ALL                          00003FFC
_WRT_BOOT                         00003FFE
_WRT_HALF                         00003FFD
_WRT_OFF                          00003FFF
_ZCDDIS_OFF                       00003F7F
_ZCDDIS_ON                        00003FFF
__16F1703                         00000001
add_time                          00000071
alarm                             000000B8
alarm_disable                     
alarm_loop                        000000C3
beep                              00000086
cancellation                      000000AF
delay                             00000124
disable_timer                     00000024
disp_test                         0000018C
display_disable                   
display_enable                    
div15                             00000143
div15_1                           0000014F
div15_2                           00000156
div15_3                           0000015D
div15_4                           00000164
div15_exit                        00000169
dup                               
flags                             00000008
infusion                          0000008C
init                              00000029
isr                               00000004
isr_exit                          00000028
isr_timer0                        0000001E
isr_timer1                        0000000D
last_pos                          0000000A
light_segment                     000000F6
main                              0000004B
msec4                             00000006
over                              
MPASM 5.68                           MAT.ASM   9-19-2016  20:20:59         PAGE 32


SYMBOL TABLE
  LABEL                             VALUE 

pause_msec                        00000184
popw                              
pushw                             
pwm_loop                          000000A3
pwm_period                        00000007
rst                               00000000
secondes                          00000005
self_test                         00000188
servo_pos                         00000107
servo_pos_exit                    00000135
servo_pos_loop                    0000011A
servo_test                        000001A0
stack                             00000000
start_msec4_tmr                   0000017B
start_timer                       0000016B
temp                              00000009
test_tmr1                         00000008
timeout                           000000B2
timeset                           00000061
timeset_exit                      0000007C
timeset_wait_btn                  00000063
tone                              000000D4
tone_test                         0000019B
trempage                          00000004
wait_loop                         00000092

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    53 reported,     0 suppressed

